# 启动日志错误分析报告

## 🔍 发现的问题

### 1. **主要问题：HTTPS 端口未启动**
- ✅ HTTP 端口 5195 正常监听
- ❌ HTTPS 端口 5196 未启动
- 服务进程 PID 22284 正在运行，但只监听 HTTP

### 2. **文件锁定问题**
- 编译失败：文件被 `UnifiedPlatform.WebApi (22284)` 锁定
- 无法重新编译和部署新版本

### 3. **配置检查结果**
- ✅ `launchSettings.json` 配置正确：`"applicationUrl": "http://localhost:5195;https://localhost:5196"`
- ✅ 开发证书已安装并信任
- ✅ `Program.cs` 中已调用 `app.UseHttpsRedirection()`

## 🔧 可能的原因

### 原因1：Kestrel 未正确配置 HTTPS
ASP.NET Core 默认情况下，如果 `launchSettings.json` 中配置了 HTTPS URL，Kestrel 应该自动监听 HTTPS 端口。但可能需要显式配置。

### 原因2：证书绑定问题
虽然证书已安装，但可能 Kestrel 无法正确绑定到端口 5196。

### 原因3：启动错误被忽略
服务可能在前台启动时遇到了错误，但错误日志没有被捕获。

## 📋 解决方案

### 方案1：显式配置 Kestrel HTTPS
在 `Program.cs` 中添加显式的 Kestrel HTTPS 配置：

```csharp
builder.WebHost.ConfigureKestrel(options =>
{
    options.ListenLocalhost(5195, listenOptions =>
    {
        listenOptions.Protocols = HttpProtocols.Http;
    });
    options.ListenLocalhost(5196, listenOptions =>
    {
        listenOptions.Protocols = HttpProtocols.Http1AndHttp2;
        listenOptions.UseHttps();
    });
});
```

### 方案2：检查启动日志
运行 `.\检查启动日志.bat` 脚本，查看完整的启动日志和错误信息。

### 方案3：手动测试 HTTPS 启动
在命令行中执行：
```bash
cd src\Backend\UnifiedPlatform.WebApi
dotnet run --launch-profile https
```

然后查看控制台输出，查找以下信息：
- `Now listening on: http://localhost:5195`
- `Now listening on: https://localhost:5196`
- 任何错误或警告信息

## 🎯 下一步操作

1. **运行检查脚本**：执行 `.\检查启动日志.bat` 查看详细日志
2. **如果发现错误**：根据错误信息修复配置
3. **如果无错误但 HTTPS 仍未启动**：考虑添加显式的 Kestrel 配置

## 📝 注意事项

- 确保服务已完全停止后再重新编译
- 检查防火墙是否阻止了端口 5196
- 验证证书是否有效：`dotnet dev-certs https --check --trust`


