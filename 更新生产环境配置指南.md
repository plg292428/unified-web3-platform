# 更新生产环境配置指南

## 步骤 1: 获取生成的密钥和密码

已生成的文件：
- `生成的密钥和密码.txt` - 包含生成的数据库密码和 JWT 密钥

## 步骤 2: 更新 appsettings.Production.json

### 当前配置

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost;Database=UnifiedWeb3Platform;User Id=sa;Password=YourPassword;TrustServerCertificate=True;"
  },
  "JwtSettings": {
    "SecurityKey": "!@#UnifiedWeb3Platform2025#@!"
  },
  "AllowedHosts": "*"
}
```

### 需要更新的内容

1. **数据库密码**: 替换 `YourPassword` 为生成的密码
2. **JWT 密钥**: 替换 `SecurityKey` 为生成的密钥
3. **AllowedHosts**: 替换 `*` 为实际域名（如果有）

### 更新后的配置示例

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=YOUR_SERVER;Database=UnifiedWeb3Platform;User Id=YOUR_USER;Password=生成的密码;TrustServerCertificate=True;"
  },
  "JwtSettings": {
    "Audience": "UnifiedWeb3Platform",
    "Issuer": "UnifiedWeb3Platform Server",
    "SecurityKey": "生成的JWT密钥"
  },
  "AllowedHosts": "yourdomain.com;www.yourdomain.com"
}
```

## 步骤 3: 验证配置

### 检查项

- [ ] 数据库密码已更新
- [ ] JWT 密钥已更新（至少 32 字符）
- [ ] AllowedHosts 已限制（如果部署到生产环境）
- [ ] 配置文件格式正确（JSON 有效）

### 测试连接（可选）

如果已配置生产环境数据库，可以测试连接：
```bash
# 使用 SQL Server Management Studio 或命令行工具测试连接
```

## 步骤 4: 安全存储

### 推荐方法

1. **使用环境变量**（推荐）
   - 将密码和密钥存储在环境变量中
   - 配置文件引用环境变量

2. **使用密钥管理服务**
   - Azure Key Vault
   - AWS Secrets Manager
   - HashiCorp Vault

3. **使用 User Secrets**（仅开发环境）
   ```bash
   dotnet user-secrets set "ConnectionStrings:DefaultConnection:Password" "密码"
   ```

### 不要这样做

- ❌ 不要将包含真实密码的文件提交到 Git
- ❌ 不要在代码中硬编码密码
- ❌ 不要通过邮件或聊天工具发送密码

## 步骤 5: 更新 .gitignore

确保以下文件不会被提交：
```
生成的密钥和密码.txt
appsettings.Production.json  # 如果包含真实密码
*.secrets.json
```

## 验证清单

- [ ] 已从 `生成的密钥和密码.txt` 获取密码和密钥
- [ ] 已更新 `appsettings.Production.json`
- [ ] 配置文件格式正确
- [ ] 已更新 `.gitignore`（如果需要）
- [ ] 已备份原始配置（如果需要）

## 注意事项

⚠️ **重要**:
- 更新配置后，需要重启服务才能生效
- 如果使用环境变量，确保服务可以访问这些变量
- 生产环境部署前，务必测试配置是否正确


