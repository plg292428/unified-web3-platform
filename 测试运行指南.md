# 项目测试运行指南

## ✅ 当前状态

### 编译状态
- ✅ **编译成功**
- ✅ **0个错误**
- ✅ **0个警告**

### 配置状态
- ✅ **数据库连接**: 已配置为SmallTarget数据库
- ✅ **JWT设置**: 已配置
- ✅ **IP区域服务**: 已配置（ip2region.xdb文件存在）
- ✅ **所有服务**: 已注册

## 🚀 运行项目

### 方法1：使用批处理脚本（推荐）

```powershell
# 快速测试运行
.\quick_test.bat

# 或使用完整运行脚本
.\run_backend.bat
```

### 方法2：手动运行

```powershell
cd src\Backend\UnifiedPlatform.WebApi
dotnet run
```

## 📍 访问地址

项目启动后，可以通过以下地址访问：

- **HTTPS API**: `https://localhost:7266`
- **HTTP API**: `http://localhost:5195`
- **Swagger UI**: `https://localhost:7266/swagger`
- **健康检查**: `https://localhost:7266/health`

## 🧪 测试步骤

### 1. 启动项目

```powershell
.\run_backend.bat
```

等待看到类似以下输出：
```
Now listening on: https://localhost:7266
Now listening on: http://localhost:5195
Application started. Press Ctrl+C to shut down.
```

### 2. 测试健康检查端点

在浏览器中访问：
```
https://localhost:7266/health
```

**预期结果：**
```json
{
  "status": "healthy",
  "timestamp": "2025-01-27T..."
}
```

### 3. 访问Swagger UI

在浏览器中访问：
```
https://localhost:7266/swagger
```

应该能看到所有API端点的文档。

### 4. 测试API端点

在Swagger UI中可以：
- 查看所有可用的API端点
- 测试各个API功能
- 验证数据库连接是否正常

## ⚠️ 可能遇到的问题

### 1. 数据库连接失败

**错误信息：**
```
Cannot open database "SmallTarget"
```

**解决方案：**
- 确保SmallTarget数据库已存在
- 检查连接字符串是否正确
- 验证SQL Server LocalDB是否运行

**检查数据库：**
```powershell
sqlcmd -S "(localdb)\MSSQLLocalDB" -Q "SELECT name FROM sys.databases WHERE name = 'SmallTarget'"
```

### 2. 端口被占用

**错误信息：**
```
Failed to bind to address https://localhost:7266
```

**解决方案：**
- 关闭占用端口的其他程序
- 或修改 `launchSettings.json` 中的端口号

### 3. 证书问题

**错误信息：**
```
HTTPS证书错误

**解决方案：**
- 开发环境可以忽略证书警告
- 或在浏览器中点击"高级" → "继续访问"

### 4. IP区域服务错误

**错误信息：**
```
ip2region.xdb does not exist

**解决方案：**
- ip2region.xdb文件已存在，应该不会出现此错误
- 如果出现，检查文件路径是否正确

## 📋 测试检查清单

启动项目后，检查以下内容：

- [ ] 项目成功启动，无错误信息
- [ ] 健康检查端点 `/health` 返回成功
- [ ] Swagger UI 可以正常访问
- [ ] API端点列表显示正常
- [ ] 数据库连接正常（如有错误会在日志中显示）

## 🎯 成功标志

如果看到以下输出，说明运行成功：

```
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: https://localhost:7266
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:5195
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
```

并且可以访问：
- ✅ Swagger UI
- ✅ 健康检查端点
- ✅ API端点正常响应

## 📝 下一步

项目成功运行后，可以：

1. **测试API功能**
   - 在Swagger UI中测试各个端点
   - 验证数据库操作是否正常

2. **启动前端项目**
   ```powershell
   .\run_frontend.bat
   ```

3. **集成测试**
   - 测试前后端集成
   - 验证完整功能流程

## ✅ 测试完成状态

**项目已准备就绪，可以开始测试运行！**

