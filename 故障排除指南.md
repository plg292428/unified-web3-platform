# 浏览器无法打开地址 - 故障排除指南

## 🔍 问题诊断

### 可能的原因

1. **服务未成功启动**
   - 启动时遇到错误
   - 数据库连接失败
   - 配置问题

2. **端口未监听**
   - 服务启动失败
   - 端口被占用
   - 防火墙阻止

3. **数据库连接问题**
   - SmallTarget数据库不存在
   - 连接字符串错误
   - LocalDB未运行

## 🛠️ 排查步骤

### 步骤1：检查服务是否启动

```powershell
# 检查dotnet进程
Get-Process -Name dotnet -ErrorAction SilentlyContinue

# 检查端口
netstat -ano | findstr ":7266 :5195"
```

**如果端口未被监听，说明服务未启动。**

### 步骤2：查看启动错误

运行调试脚本：
```powershell
.\debug_startup.bat
```

或直接运行查看错误：
```powershell
cd src\Backend\UnifiedPlatform.WebApi
dotnet run
```

**查看控制台输出的错误信息。**

### 步骤3：检查数据库连接

```powershell
# 检查数据库是否存在
sqlcmd -S "(localdb)\MSSQLLocalDB" -Q "SELECT name FROM sys.databases WHERE name = 'SmallTarget'"
```

**如果数据库不存在，需要：**
1. 使用原有SmallTarget项目创建数据库
2. 或修改连接字符串指向其他数据库

### 步骤4：检查配置文件

验证 `appsettings.json`：
```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Data Source=(localdb)\\MSSQLLocalDB;Initial Catalog=SmallTarget;..."
  }
}
```

## 🔧 解决方案

### 方案1：修复数据库连接（如果数据库不存在）

**选项A：使用其他数据库**

如果SmallTarget数据库不存在，可以：

1. **修改连接字符串指向其他数据库：**
   ```json
   "DefaultConnection": "Data Source=(localdb)\\MSSQLLocalDB;Initial Catalog=其他数据库名;..."
   ```

2. **或创建SmallTarget数据库：**
   - 使用原有SmallTarget项目
   - 或运行数据库迁移

**选项B：跳过数据库初始化错误**

如果数据库连接是可选的，可以临时注释掉数据库相关代码。

### 方案2：检查并修复启动错误

1. **运行调试脚本：**
   ```powershell
   .\debug_startup.bat
   ```

2. **查看详细错误信息：**
   - 复制错误信息
   - 根据错误信息解决问题

3. **常见错误：**
   - 数据库连接失败 → 检查数据库
   - 缺少依赖 → 运行 `dotnet restore`
   - 配置错误 → 检查配置文件

### 方案3：使用详细日志模式

修改 `appsettings.json` 增加日志级别：
```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Debug",
      "Microsoft.AspNetCore": "Information"
    }
  }
}
```

## 📋 快速检查清单

运行以下检查：

- [ ] 编译是否成功：`dotnet build`
- [ ] 数据库是否存在：检查SmallTarget数据库
- [ ] 端口是否监听：`netstat -ano | findstr ":7266"`
- [ ] 配置文件是否正确：检查appsettings.json
- [ ] 服务是否启动：查看dotnet进程

## 🚀 重新启动

### 方法1：使用调试脚本

```powershell
.\debug_startup.bat
```

这将显示详细的启动信息，帮助定位问题。

### 方法2：手动运行

```powershell
cd src\Backend\UnifiedPlatform.WebApi
dotnet run
```

查看控制台输出的错误信息。

## ⚠️ 常见错误及解决方案

### 错误1：Cannot open database "SmallTarget"

**原因：** 数据库不存在

**解决方案：**
1. 创建SmallTarget数据库
2. 或修改连接字符串指向存在的数据库

### 错误2：A network-related or instance-specific error

**原因：** LocalDB未运行或无法连接

**解决方案：**
1. 检查LocalDB是否安装
2. 启动LocalDB服务
3. 或使用SQL Server Express

### 错误3：The process cannot access the file

**原因：** 端口被占用

**解决方案：**
1. 关闭占用端口的程序
2. 或修改端口号

## 📝 下一步

1. **运行调试脚本查看错误：**
   ```powershell
   .\debug_startup.bat
   ```

2. **根据错误信息修复问题**

3. **重新启动服务测试**

## 🔍 需要帮助

如果仍然无法解决，请提供：
1. 运行 `.\debug_startup.bat` 的完整输出
2. 控制台显示的错误信息
3. 数据库连接测试结果

这样我可以更准确地帮你解决问题。

