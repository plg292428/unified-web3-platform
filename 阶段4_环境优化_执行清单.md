# 阶段4: 环境优化执行清单

## 执行步骤

### ✅ 4.1 生产环境配置优化

- [ ] **更新数据库连接字符串**
  - [ ] 替换 `appsettings.Production.json` 中的 `YourPassword`
  - [ ] 使用实际的强密码
  - [ ] 考虑使用专用数据库用户（而非 sa）

- [ ] **增强 JWT 安全性**
  - [ ] 生成强随机密钥（至少 32 字符）
  - [ ] 更新 `JwtSettings:SecurityKey`
  - [ ] 考虑使用环境变量存储密钥

- [ ] **限制允许的主机**
  - [ ] 更新 `AllowedHosts` 为实际域名
  - [ ] 移除通配符 `*`

- [ ] **优化日志配置**
  - [ ] 生产环境使用 `Warning` 级别
  - [ ] 配置日志文件输出（如果需要）

### ✅ 4.2 HTTPS 配置（可选）

- [ ] **开发环境 HTTPS**
  - [ ] 运行 `dotnet dev-certs https --trust`
  - [ ] 验证证书安装

- [ ] **生产环境 HTTPS**
  - [ ] 获取 SSL 证书
  - [ ] 配置 Kestrel HTTPS
  - [ ] 启用 HTTPS 重定向
  - [ ] 测试 HTTPS 连接

### ✅ 4.3 安全策略配置

- [ ] **CORS 配置优化**
  - [ ] 限制允许的源（生产环境）
  - [ ] 配置允许的 HTTP 方法
  - [ ] 配置允许的请求头

- [ ] **其他安全配置**
  - [ ] 检查敏感信息是否暴露
  - [ ] 配置安全响应头（如果需要）
  - [ ] 配置请求大小限制（如果需要）

## 立即执行的操作

### 优先级 1: 必须完成（生产环境部署前）

1. ✅ 更新数据库密码
2. ✅ 更新 JWT 密钥
3. ✅ 限制 AllowedHosts

### 优先级 2: 强烈建议（生产环境）

1. ⚠️ 配置 HTTPS
2. ⚠️ 优化 CORS 配置
3. ⚠️ 优化日志配置

### 优先级 3: 可选优化

1. ⚠️ 配置环境变量
2. ⚠️ 配置密钥管理服务
3. ⚠️ 配置监控和告警

## 验证清单

- [ ] 生产环境配置已更新
- [ ] 敏感信息已从配置文件移除
- [ ] HTTPS 已配置（如果启用）
- [ ] CORS 已优化
- [ ] 日志配置已优化
- [ ] 所有配置已测试

## 配置文件位置

- `appsettings.json` - 开发环境配置
- `appsettings.Production.json` - 生产环境配置
- `appsettings.Production.template.json` - 生产环境配置模板
- `Program.cs` - 程序配置

## 相关文档

- `阶段4_环境优化_配置指南.md` - 详细配置指南
- `环境变量配置说明.md` - 环境变量使用方法
- `配置HTTPS指南.md` - HTTPS 配置指南

## 注意事项

⚠️ **重要**: 
- 更新配置前请备份现有配置
- 不要将包含真实密码的配置文件提交到 Git
- 生产环境部署前必须完成优先级 1 的所有项目


