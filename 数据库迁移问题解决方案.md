# 数据库迁移问题解决方案

**问题描述**: 迁移文件 `AddProductReviewImageSpecificationOnly` 试图创建已存在的表（Orders、Product 等），导致迁移失败。

**原因分析**:
1. 之前的迁移 `AddShoppingTables` 已经创建了 Orders、Product、ProductCategory 等表
2. 新迁移文件包含了所有表的创建语句，而不仅仅是新的三个表
3. EF Core 模型快照包含了所有实体，所以生成的迁移会包含所有表的创建

---

## 解决方案

### 方案 A：手动创建新表（推荐）⭐⭐⭐⭐⭐

**优点**: 简单直接，不影响现有数据

**步骤**:

1. **执行 SQL 脚本创建新表**
   - 使用 `创建新表脚本.sql` 直接创建三个新表

2. **标记迁移为已应用**
   - 在 `__EFMigrationsHistory` 表中添加迁移记录

3. **验证表结构**
   - 确认三个新表已创建成功

---

### 方案 B：修复迁移文件

**优点**: 保持迁移历史完整

**步骤**:

1. **编辑迁移文件**
   - 移除已存在表的创建语句
   - 只保留新表的创建语句

2. **重新执行迁移**
   - 运行 `dotnet ef database update`

---

### 方案 C：删除迁移并重新生成

**优点**: 完全重新生成

**步骤**:

1. **删除当前迁移**
   - `dotnet ef migrations remove`

2. **手动创建新表**
   - 执行 SQL 脚本

3. **更新模型快照**
   - 手动编辑模型快照文件

---

## 推荐执行方案 A

**理由**:
- ✅ 最简单直接
- ✅ 不影响现有数据
- ✅ 风险最低
- ✅ 执行时间最短

---

## 执行步骤

### 步骤 1: 创建新表 SQL 脚本

执行 `创建新表脚本.sql` 文件中的 SQL 语句。

### 步骤 2: 标记迁移为已应用

在数据库中执行：
```sql
INSERT INTO __EFMigrationsHistory (MigrationId, ProductVersion)
VALUES ('20251112073154_AddProductReviewImageSpecificationOnly', '8.0.0');
```

### 步骤 3: 验证

检查三个新表是否已创建：
- ProductReviews
- ProductImages
- ProductSpecifications

---

**执行完成后，项目即可正常使用！**

