# 步骤2：配置连接字符串 - 完成报告

## 任务目标
更新 `appsettings.json` 中的连接字符串，配置为使用 `UnifiedWeb3Platform` 数据库

## 执行结果

### ✅ 连接字符串已更新

**已更新的文件**:
1. ✅ `appsettings.json` - 开发环境配置（使用 LocalDB）
2. ✅ `appsettings.Production.json` - 生产环境配置（使用 SQL Server）

## 配置详情

### 1. appsettings.json（开发环境 - LocalDB）

**更新前**:
```json
"DefaultConnection": "Data Source=(localdb)\\MSSQLLocalDB;Initial Catalog=SmallTarget;Integrated Security=True;TrustServerCertificate=True;"
```

**更新后**:
```json
"DefaultConnection": "Data Source=(localdb)\\MSSQLLocalDB;Initial Catalog=UnifiedWeb3Platform;Integrated Security=True;TrustServerCertificate=True;"
```

**说明**:
- ✅ 使用 LocalDB（适合本地开发）
- ✅ 数据库名称已更新为 `UnifiedWeb3Platform`
- ✅ 使用 Windows 集成身份验证（无需密码）

### 2. appsettings.Production.json（生产环境 - SQL Server）

**更新前**:
```json
"DefaultConnection": "Data Source=localhost;Initial Catalog=UnifiedPlatform;Integrated Security=True;TrustServerCertificate=True;"
```

**更新后**:
```json
"DefaultConnection": "Server=localhost;Database=UnifiedWeb3Platform;User Id=sa;Password=YourPassword;TrustServerCertificate=True;"
```

**说明**:
- ✅ 使用 SQL Server 连接（生产环境）
- ✅ 数据库名称已更新为 `UnifiedWeb3Platform`
- ⚠️ **需要配置**: 请将 `YourPassword` 替换为实际的 sa 密码

## 重要提示

### ⚠️ 生产环境配置注意事项

1. **密码安全**:
   - 当前配置中的 `YourPassword` 是占位符
   - **必须替换为实际的 SQL Server sa 密码**
   - 建议使用强密码

2. **SQL Server 配置**:
   - 确保 SQL Server 已启用 SQL Server 身份验证
   - 确保 sa 账户已启用
   - 确保防火墙允许连接

3. **连接字符串格式**:
   ```json
   "DefaultConnection": "Server=localhost;Database=UnifiedWeb3Platform;User Id=sa;Password=实际密码;TrustServerCertificate=True;"
   ```

### ✅ 开发环境配置

开发环境使用 LocalDB，配置已正确：
- ✅ 无需密码
- ✅ 使用 Windows 集成身份验证
- ✅ 数据库已创建

## 验证配置

### 检查连接字符串是否正确

可以使用以下 PowerShell 命令验证：

```powershell
cd "D:\claude code\plg\UnifiedWeb3Platform"
$config = Get-Content "src\Backend\UnifiedPlatform.WebApi\appsettings.json" | ConvertFrom-Json
$config.ConnectionStrings.DefaultConnection
```

### 测试数据库连接

运行以下命令测试连接：

```powershell
.\test_database_connection.bat
```

或者使用 PowerShell：

```powershell
$connectionString = "Data Source=(localdb)\MSSQLLocalDB;Initial Catalog=UnifiedWeb3Platform;Integrated Security=True;TrustServerCertificate=True;"
$connection = New-Object System.Data.SqlClient.SqlConnection($connectionString)
$connection.Open()
Write-Host "连接成功!"
$connection.Close()
```

## 配置文件位置

- ✅ `src/Backend/UnifiedPlatform.WebApi/appsettings.json` - 开发环境
- ✅ `src/Backend/UnifiedPlatform.WebApi/appsettings.Development.json` - 开发环境（当前为空，会继承 appsettings.json）
- ✅ `src/Backend/UnifiedPlatform.WebApi/appsettings.Production.json` - 生产环境

## 下一步操作

### 步骤3：运行数据库迁移

更新连接字符串后，需要运行数据库迁移来创建表结构：

```bash
cd src\Backend\UnifiedPlatform.WebApi
dotnet ef database update --project ..\UnifiedPlatform.DbService --context StDbContext
```

或者：

```bash
cd src\Backend\UnifiedPlatform.DbService
dotnet ef database update --context StDbContext
```

## 完成状态

✅ **步骤2：配置连接字符串 - 已完成**

连接字符串已更新为使用 `UnifiedWeb3Platform` 数据库。

**注意**: 
- ✅ 开发环境配置完成（LocalDB）
- ⚠️ 生产环境需要替换 `YourPassword` 为实际密码


