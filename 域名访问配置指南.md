# 前端域名访问配置指南

## 📋 配置步骤

### 方式 1: 使用现有域名（推荐）

如果已有域名 `www.a292428dsj.dpdns.org`，可以按以下步骤配置：

#### 1. 配置本地 hosts 文件（Windows）

**文件路径**: `C:\Windows\System32\drivers\etc\hosts`

**添加以下内容**:
```
127.0.0.1    www.a292428dsj.dpdns.org
127.0.0.1    a292428dsj.dpdns.org
```

**注意**: 需要管理员权限编辑 hosts 文件

#### 2. 配置 Vite 开发服务器

已更新 `vite.config.ts`，支持域名访问。

如果需要使用特定域名，可以修改：
```typescript
server: {
  port: 5173,
  host: '0.0.0.0', // 允许外部访问
  // 或指定域名
  // host: 'www.a292428dsj.dpdns.org',
}
```

#### 3. 更新后端 CORS 配置

后端 CORS 已包含以下域名：
- `https://www.a292428dsj.dpdns.org`
- `https://a292428dsj.dpdns.org`

如果需要添加 HTTP 版本的域名（本地开发），需要更新 `Program.cs`:
```csharp
.WithOrigins(
    // 生产环境域名
    "https://www.a292428dsj.dpdns.org",
    "https://a292428dsj.dpdns.org",
    // 本地开发域名（HTTP）
    "http://www.a292428dsj.dpdns.org",
    "http://a292428dsj.dpdns.org",
    // ... 其他配置
)
```

#### 4. 启动服务

```bash
# 启动后端
快速启动后端.bat

# 启动前端
快速启动前端.bat
```

#### 5. 访问

打开浏览器访问: `http://www.a292428dsj.dpdns.org:5173`

---

### 方式 2: 使用自定义域名

如果想使用其他域名，例如 `shop.local` 或 `web3shop.local`:

#### 1. 配置 hosts 文件

```
127.0.0.1    shop.local
127.0.0.1    www.shop.local
```

#### 2. 更新 Vite 配置

```typescript
server: {
  port: 5173,
  host: 'shop.local',
}
```

#### 3. 更新后端 CORS

在 `Program.cs` 中添加新域名:
```csharp
.WithOrigins(
    "http://shop.local:5173",
    "http://www.shop.local:5173",
    // ... 其他配置
)
```

#### 4. 访问

打开浏览器访问: `http://shop.local:5173`

---

## 🔧 详细配置说明

### Vite 开发服务器配置

**文件**: `src/Frontend/web-app/vite.config.ts`

```typescript
server: {
  port: 5173,              // 端口号
  host: '0.0.0.0',         // 允许外部访问（所有网络接口）
  // host: 'localhost',    // 仅本地访问
  // host: '域名',         // 使用特定域名
  strictPort: false,       // 如果端口被占用，尝试其他端口
  open: true,              // 自动打开浏览器（可选）
}
```

### 后端 CORS 配置

**文件**: `src/Backend/UnifiedPlatform.WebApi/Program.cs`

确保包含前端域名（HTTP 和 HTTPS）:
```csharp
.WithOrigins(
    // 生产环境（HTTPS）
    "https://www.a292428dsj.dpdns.org",
    "https://a292428dsj.dpdns.org",
    // 本地开发（HTTP）
    "http://www.a292428dsj.dpdns.org:5173",
    "http://a292428dsj.dpdns.org:5173",
    // 默认本地地址
    "http://localhost:5173",
    "http://127.0.0.1:5173",
)
```

---

## 🚀 快速配置脚本

### Windows 配置 hosts 文件

创建批处理文件 `配置域名访问.bat`:

```batch
@echo off
chcp 65001 >nul
echo.
echo ========================================
echo   配置域名访问
echo ========================================
echo.

echo 需要管理员权限来编辑 hosts 文件
echo.

:: 检查管理员权限
net session >nul 2>&1
if %errorLevel% neq 0 (
    echo [错误] 需要管理员权限
    echo 请右键以管理员身份运行此脚本
    pause
    exit /b 1
)

echo [1/2] 备份 hosts 文件...
copy /Y C:\Windows\System32\drivers\etc\hosts C:\Windows\System32\drivers\etc\hosts.backup
echo [OK] 备份完成

echo.
echo [2/2] 添加域名映射...
(
    echo.
    echo # Web3 Shopping Platform
    echo 127.0.0.1    www.a292428dsj.dpdns.org
    echo 127.0.0.1    a292428dsj.dpdns.org
) >> C:\Windows\System32\drivers\etc\hosts

echo [OK] 配置完成
echo.
echo 已添加以下域名映射:
echo   127.0.0.1    www.a292428dsj.dpdns.org
echo   127.0.0.1    a292428dsj.dpdns.org
echo.
echo 现在可以访问: http://www.a292428dsj.dpdns.org:5173
echo.
pause
```

---

## ✅ 验证配置

### 1. 检查 hosts 文件

```bash
# Windows
type C:\Windows\System32\drivers\etc\hosts

# 应该看到域名映射
127.0.0.1    www.a292428dsj.dpdns.org
```

### 2. 测试域名解析

```bash
# Windows
ping www.a292428dsj.dpdns.org

# 应该返回 127.0.0.1
```

### 3. 访问前端

打开浏览器访问: `http://www.a292428dsj.dpdns.org:5173`

### 4. 检查 CORS

打开浏览器开发者工具，查看 Network 标签：
- API 请求应该返回 200 OK
- 不应该有 CORS 错误

---

## 🔍 常见问题

### 问题 1: 无法访问域名

**可能原因**:
- hosts 文件未正确配置
- 需要管理员权限
- 浏览器缓存

**解决方法**:
1. 检查 hosts 文件是否正确
2. 以管理员身份运行配置脚本
3. 清除浏览器缓存
4. 使用无痕模式测试

---

### 问题 2: CORS 错误

**可能原因**:
- 后端 CORS 配置未包含域名
- 域名格式不正确（缺少端口号）

**解决方法**:
1. 检查 `Program.cs` 中的 CORS 配置
2. 确保包含 HTTP 版本的域名（本地开发）
3. 确保包含端口号（如 `:5173`）
4. 重启后端服务

---

### 问题 3: 端口被占用

**可能原因**:
- 5173 端口已被其他程序使用

**解决方法**:
1. 修改 `vite.config.ts` 中的端口号
2. 或使用 `strictPort: false` 自动选择其他端口

---

## 📝 注意事项

1. **hosts 文件权限**: 编辑 hosts 文件需要管理员权限
2. **端口号**: 确保域名访问时包含端口号（如 `:5173`）
3. **HTTPS**: 如果需要 HTTPS，需要配置 SSL 证书
4. **生产环境**: 生产环境应该使用 HTTPS 和标准端口（80/443）
5. **DNS**: 如果使用真实域名，需要配置 DNS 解析

---

## 🎯 下一步

配置完成后：
1. 重启前端服务
2. 访问配置的域名
3. 验证功能是否正常
4. 检查浏览器控制台是否有错误

