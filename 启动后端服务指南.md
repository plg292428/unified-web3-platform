# 启动后端服务指南

**更新时间**: 2025-11-12  
**目的**: 启动后端服务以使用完整功能

---

## 一、两种模式说明

### 模式 1: 访客模式（后端未运行）

**特点**:
- ✅ 前端可以正常显示
- ✅ 可以浏览商品列表（只读，如果有静态数据）
- ❌ 无法加载商品数据（需要后端 API）
- ❌ 无法使用购物车、订单等功能
- ❌ 无法使用 Web3 支付功能

**适用场景**:
- 仅查看前端界面
- 后端服务暂时不可用
- 开发调试前端界面

---

### 模式 2: 完整模式（后端运行）

**特点**:
- ✅ 前端可以正常显示
- ✅ 可以加载商品数据（从数据库）
- ✅ 可以使用购物车、订单等功能
- ✅ 可以使用 Web3 支付功能
- ✅ 可以使用所有完整功能

**适用场景**:
- 完整功能测试
- 实际使用
- 开发调试完整流程

---

## 二、启动后端服务步骤

### 步骤 1: 检查数据库连接

1. **确认数据库服务运行**
   - SQL Server 应该正在运行
   - 数据库 `UnifiedWeb3Platform` 应该已创建

2. **检查连接字符串**
   - 文件: `src/Backend/UnifiedPlatform.WebApi/appsettings.json`
   - 确认连接字符串正确

---

### 步骤 2: 编译后端项目（如果需要）

```bash
cd src/Backend/UnifiedPlatform.WebApi
dotnet build
```

---

### 步骤 3: 运行数据库迁移（如果需要）

```bash
cd src/Backend/UnifiedPlatform.DbService
dotnet ef database update
```

---

### 步骤 4: 启动后端服务

**方法 1: 使用 dotnet run（推荐）**

```bash
cd src/Backend/UnifiedPlatform.WebApi
dotnet run
```

**方法 2: 使用 Visual Studio**

1. 打开 `UnifiedPlatform.WebApi` 项目
2. 按 `F5` 运行

**方法 3: 使用已编译的可执行文件**

```bash
cd src/Backend/UnifiedPlatform.WebApi/bin/Debug/net8.0
.\UnifiedPlatform.WebApi.exe
```

---

### 步骤 5: 验证后端服务

1. **检查服务状态**
   - 终端应该显示: `Now listening on: http://localhost:5000`
   - 或者: `Now listening on: https://localhost:5001`

2. **测试 API 连接**
   - 打开浏览器访问: `http://localhost:5000/swagger`
   - 或者访问: `http://localhost:5000/api/store/products`
   - 应该返回 JSON 数据

---

## 三、启动前端服务

### 步骤 1: 启动前端开发服务器

```bash
cd src/Frontend/web-app
npm run dev
```

### 步骤 2: 访问前端

- 打开浏览器访问: `http://localhost:5173`
- 应该正常显示，并且可以加载商品数据

---

## 四、完整测试流程

### 1. 启动后端服务

```bash
# 终端 1: 启动后端
cd src/Backend/UnifiedPlatform.WebApi
dotnet run
```

**预期输出**:
```
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://localhost:5000
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
```

---

### 2. 启动前端服务

```bash
# 终端 2: 启动前端
cd src/Frontend/web-app
npm run dev
```

**预期输出**:
```
  VITE v5.x.x  ready in XXX ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: use --host to expose
```

---

### 3. 验证功能

1. **打开浏览器**: `http://localhost:5173`
2. **检查控制台**:
   - 应该看到: "API Base URL from serverConfig.json: http://localhost:5000"
   - 不应该看到: "后端服务未运行，进入访客模式"
3. **测试功能**:
   - 商品列表应该正常加载
   - 可以添加到购物车
   - 可以创建订单
   - 可以使用 Web3 支付

---

## 五、常见问题

### 问题 1: 后端服务启动失败

**可能原因**:
- 数据库连接失败
- 端口被占用
- 缺少依赖

**解决方法**:
1. 检查数据库服务是否运行
2. 检查连接字符串是否正确
3. 检查端口 5000 是否被占用
4. 运行 `dotnet restore` 安装依赖

---

### 问题 2: 前端无法连接后端

**可能原因**:
- 后端服务未运行
- CORS 配置问题
- 端口不匹配

**解决方法**:
1. 确认后端服务正在运行
2. 检查 `serverConfig.json` 中的 `developmentBaseUrl`
3. 检查后端 `Program.cs` 中的 CORS 配置

---

### 问题 3: 数据库迁移失败

**可能原因**:
- 数据库不存在
- 迁移冲突
- 连接字符串错误

**解决方法**:
1. 创建数据库: `CREATE DATABASE UnifiedWeb3Platform;`
2. 检查迁移历史: `SELECT * FROM __EFMigrationsHistory;`
3. 手动执行 SQL 脚本（如果迁移冲突）

---

## 六、快速启动脚本

### Windows (启动所有服务.bat)

```batch
@echo off
echo 启动后端服务...
start "后端服务" cmd /k "cd src\Backend\UnifiedPlatform.WebApi && dotnet run"

timeout /t 5 /nobreak

echo 启动前端服务...
start "前端服务" cmd /k "cd src\Frontend\web-app && npm run dev"

echo.
echo 服务已启动！
echo 后端: http://localhost:5000
echo 前端: http://localhost:5173
pause
```

---

## 七、总结

### 推荐流程

1. **先启动后端服务**
   - 确保数据库连接正常
   - 运行 `dotnet run`

2. **再启动前端服务**
   - 运行 `npm run dev`
   - 访问 `http://localhost:5173`

3. **验证功能**
   - 检查商品列表是否加载
   - 测试购物车、订单等功能

---

### 注意事项

- 后端服务必须先启动，前端才能使用完整功能
- 访客模式可以在后端未运行时使用，但功能受限
- 开发时建议同时运行两个服务

---

**指南生成时间**: 2025-11-12

